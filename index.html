<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
</head>
<body>
  <nav>
    <select id="lang-selector" name="lang" class="nav-select">
      <option value="en">English</option>
      <option value="ko">한국어 (Korean)</option>
      <option value="zh">中文 (Chinese)</option>
    </select>
    <select id="ver-selector" name="ver" class="nav-select">
      <option value="main">main</option>
      <option value="v1.15">v1.15</option>
    </select>
  </nav>

  <div id="app"></div>
  <script>
    window.$docsify = {
      name: 'PX4 User Guide',
	  /*
      name: '<a id="logo-link" class="app-name-link" data-nosearch href="/"><div class="sidebar-logo">' +
              '<img src="./assets/logo.png" height="64px">' +
              '<span class="sidebar-logo-title">PX4 User Guide</span>' +
            '</div></a>',
      */
      repo: 'https://github.com/PX4/PX4-user_guide',

      loadSidebar: 'SUMMARY.md',
      //loadNavbar: true,
      relativePath: true,
      //fallbackLanguages: ['zh', 'ko'],

      //This is correct, but will fail as site is too big.
      search: {
        paths: 'auto',
        //namespace: 'px4-website',
        hideOtherSidebarContent: true,
        depth: 4,
        pathNamespaces: /^\/(main|v1\.15){1}\/(zh|en|ko){1}/
      },
/*
      search: {
        paths: 'auto',
        namespace: 'px4-website',
        hideOtherSidebarContent: true,
        depth: 3,
        pathNamespaces:/^(\/main){1}(\/(zh|en|ko)){1}/  matches on NOT main but does get the languages
      },
*/
      namespaces: [
        {
          id: "version",
          values: ["main", "v1.15"],
          optional: false,
          selector: "#ver-selector",
          default: "main",
        },
        {
          id: "lang",
          values: ["en","zh","ko"],
          optional: false,
          selector: "#lang-selector",
          default: "en",
        },
      ],

      alias: {


            '/v(\\d+)\.(\\d+)/(en|zh|ko)/(.*)': "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/v$1.$2/$3/$4",
            '/main/(en|zh|ko)/(.*)': "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/main/$1/$2",
			//'/.*/_navbar.md': '/_navbar.md',


          //'/.*/_navbar.md': '/_navbar.md',

		  //VERSIONS assuming fallback to English.
            //'/(en|zh|ko)/v(\\d+)\.(\\d+)/(.*)': "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/v$2.$3/$1/$4",
            //'/(en|zh|ko)/main/(.*)': "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/main/$1/$2",
        },

      plugins: [
        function(hook, vm) {

          //Fixup images. There's bug that means it can't find them in the tree, but we can get them from github.
          hook.beforeEach(function(content) {

            if (vm.isRemoteUrl && !vm.isHTML) {

              let my_dir_path = vm.route.file.split('/');
              my_dir_path.pop();
              let fixcontent = content.replace(/\!\[(.*?)\]\((.*?)\)/g, 
                (match, title, path) => {
                  let linkrootpath=my_dir_path.slice();
                  let relpath = path;
                  if (relpath.startsWith('../')) {

                    while (relpath.startsWith('../')) {
                      relpath = relpath.slice(3);
                      linkrootpath.pop();
                    }

                  linkrootpath = linkrootpath.join('/');
                  linkrootpath = `${linkrootpath}/${relpath}`;
                  let imagestring = `<img src="${linkrootpath}" title="${title}" />`;
                  return imagestring;
                  }
                  else {
                    return match;
                  }

                }
              );
			  
			  //Fixup images in HTML to absolute path
              fixcontent = fixcontent.replace(/ src\=["'](.*?)["']/g, 
                (match, path) => {
                  let linkrootpath=my_dir_path.slice();
                  let relpath = path;
                  if (relpath.startsWith('../')) {

                    while (relpath.startsWith('../')) {
                      relpath = relpath.slice(3);
                      linkrootpath.pop();
                    }

                  linkrootpath = linkrootpath.join('/');
                  linkrootpath = `${linkrootpath}/${relpath}`;
                  let imagestring = ` src='${linkrootpath}'`;
                  return imagestring;
                  }
                  else {
                    return match;
                  }

                }
              );


              // Fix up notes/tips
              fixcontent = fixcontent.replaceAll('> **Note** ','\n?> **Note:** ');
              fixcontent = fixcontent.replaceAll('> **Tip** ','\n?> **Tip:** ');
              fixcontent = fixcontent.replaceAll('> **Warning** ','\n!> **Warning:** ');
              fixcontent = fixcontent.replaceAll('> **Caution** ','\n!> **Warning:** ');
			  

              fixcontent = fixcontent.replaceAll(/\s*{#([\w-]*)}/g, " :id=$1");
			  
              // Match asides with ::: syntax
			  fixcontent = fixcontent.replaceAll(/\:{3}(\S+)$(.*?)\:{3}/gsm, 
			   (match, type, note_text) => {
			     if (type.startsWith('note')) {
				    return `\n?> **Note:** ${note_text}`;
				 }
			     else if (type.startsWith('tip')) {
				    return `\n?> **Tip:** ${note_text}`;
				 }
			     else if (type.startsWith('warning')) {
				    return `\n!> **Warning:** ${note_text}`;
				 }
			   return match;
			   }
			  );

              return fixcontent;
            }

            return content
          });


        }
      ],
		
    }
  </script>
  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
  
  <!-- Namespaces: https://evilmartians.com/chronicles/easy-multi-language-multi-version-documentation-with-docsify-git-and-github-actions  -->
  <script src="https://unpkg.com/docsify-namespaced"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
</body>
</html>
