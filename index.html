<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
</head>
<body>
  <div id="app"></div>
  <script>
    window.$docsify = {
      name: 'PX4 User Guide',
      repo: 'https://github.com/PX4/PX4-user_guide',

      loadSidebar: 'SUMMARY.md',
      //loadNavbar: true,
      relativePath: true,
      fallbackLanguages: ['zh', 'ko'],

      alias: {
          '/en/main/(.*)':
            'https://raw.githubusercontent.com/PX4/PX4-user_guide/main/en/$1',
          'en/zh/(.*)':
            'https://raw.githubusercontent.com/PX4/PX4-user_guide/main/zh/$1',
          '/.*/_navbar.md': '/_navbar.md',
          //'/en/(.*)':'/main/en/$1', //Default fallback now fallback to the English version (used with fallbackLanguages)
          //'/zh/(.*)':'/main/zh/$1', //Default fallback now fallback to the Zh version (used with fallbackLanguages)
          '/(.*)':'/main/en/$1' //Default fallback now fallback to the English version (used with fallbackLanguages)
        },

      plugins: [
        function(hook, vm) {

          //Fixup images. There's bug that means it can't find them in the tree, but we can get them from github.
          hook.beforeEach(function(content) {

            if (vm.isRemoteUrl && !vm.isHTML) {

              let my_dir_path = vm.route.file.split('/');
              my_dir_path.pop();
              let fixcontent = content.replace(/\!\[(.*?)\]\((.*?)\)/g, 
                (match, title, path) => {
                  let linkrootpath=my_dir_path.slice();
                  let relpath = path;
                  if (relpath.startsWith('../')) {

                    while (relpath.startsWith('../')) {
                      relpath = relpath.slice(3);
                      linkrootpath.pop();
                    }

                  linkrootpath = linkrootpath.join('/');
                  linkrootpath = `${linkrootpath}/${relpath}`;
                  let imagestring = `<img src="${linkrootpath}" title="${title}" />`;
                  return imagestring;
                  }
                  else {
                    return match;
                  }

                }
              );


              // Fix up notes/tips
              fixcontent = fixcontent.replaceAll('> **Note** ','\n?> **Note:** ');
              fixcontent = fixcontent.replaceAll('> **Tip** ','\n?> **Tip:** ');
              fixcontent = fixcontent.replaceAll('> **Warning** ','\n!> **Warning:** ');
              fixcontent = fixcontent.replaceAll('> **Caution** ','\n!> **Warning:** ');
			  
			  

              fixcontent = fixcontent.replaceAll(/\s*{#([\w-]*)}/g, " :id=$1");
			  
              // Match asides with ::: syntax
			  fixcontent = fixcontent.replaceAll(/\:{3}(\S+)$(.*?)\:{3}/gsm, 
			   (match, type, note_text) => {
			     if (type.startsWith('note')) {
				    return `\n?> **Note:** ${note_text}`;
				 }
			     else if (type.startsWith('tip')) {
				    return `\n?> **Tip:** ${note_text}`;
				 }
			     else if (type.startsWith('warning')) {
				    return `\n!> **Warning:** ${note_text}`;
				 }
			   return match;
			   }
			  );

              return fixcontent;
            }

            return content
          });


        }
      ],
		
    }
  </script>
  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
</body>
</html>
