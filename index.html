<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
<style>
.material-icons.md-18 { font-size: 18px; }
</style>
  <nav>
    <select id="lang-selector" name="lang" class="nav-select">
      <option value="en">English</option>
      <option value="ko">한국어 (Korean)</option>
      <option value="zh">中文 (Chinese)</option>
    </select>
    <select id="ver-selector" name="ver" class="nav-select">
      <option value="main">main</option>
      <option value="v1.15">v1.15</option>
    </select>
    <a id="edit_link" target="_blank" title="Edit on Github" class="icon-edit" style="display: none; font-size: 18px;"><span class='material-icons md-18'>mode_edit</span></a>
  </nav>

  <div id="app"></div>
  <script>
  
    window.$docsify = {
      name: 'PX4 User Guide',
      repo: 'https://github.com/PX4/PX4-user_guide',

      loadSidebar: 'SUMMARY.md',
      relativePath: true,
      //loadNavbar: true, // Currently need to use coded navbar to get selectors working.
      //fallbackLanguages: ['zh', 'ko'],  //Not using fallback. This only works back to the "root" so would have to make en/master in the root. Messy.

      //This is correct, but will fail as site is too big for localStorage
      search: {
        paths: 'auto',
        //namespace: 'px4-website',
        hideOtherSidebarContent: true,
        depth: 4,
        pathNamespaces: /^\/(main|v1\.15){1}\/(zh|en|ko){1}/
      },

      namespaces: [
        {
          id: "version",
          values: ["main", "v1.15"],
          optional: false,
          selector: "#ver-selector",
          default: "main",
        },
        {
          id: "lang",
          values: ["en","zh","ko"],
          optional: false,
          selector: "#lang-selector",
          default: "en",
        },
      ],

      alias: {
        '/v(\\d+)\.(\\d+)/(en|zh|ko)/(.*)': "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/v$1.$2/$3/$4",
        '/main/(en|zh|ko)/(.*)': "https://raw.githubusercontent.com/hamishwillee/PX4-user_guide/main/$1/$2",

        //'/.*/_navbar.md': '/_navbar.md',
        },



      plugins: [

        function(hook, vm) {

          //Fixup images. 
          // There's bug that means it can't find them in the tree
          // But we can get them from github as they have relative links
          hook.beforeEach(function(content) {

            if (vm.isRemoteUrl && !vm.isHTML) {
			
			
			
              // Set edit link for the english pages only
              let current_file = vm.route.file;
              current_file=current_file.split("/main/en/");
              const navMenuEditLink = document.getElementById("edit_link");
              if (current_file.length == 2) {
                let editlink=current_file[1];
                editlink=`${$docsify.repo}/edit/main/en/${editlink}`;
                navMenuEditLink.setAttribute("href", editlink);
                navMenuEditLink.setAttribute('style','display: inline;');
              } else {
                navMenuEditLink.setAttribute('style','display: none; font-size: 30px;');
              }
			
			
			
			
			

              let my_dir_path = vm.route.file.split('/');
              my_dir_path.pop();

              //Fixup images in Markdown style images to absolute path
              let fixcontent = content.replace(/\!\[(.*?)\]\((.*?)\)/g, 
                (match, title, path) => {
                  let linkrootpath=my_dir_path.slice();
                  let relpath = path;
                  if (relpath.startsWith('../')) {
                    while (relpath.startsWith('../')) {
                      relpath = relpath.slice(3);
                      linkrootpath.pop();
                    }
                  linkrootpath = linkrootpath.join('/');
                  linkrootpath = `${linkrootpath}/${relpath}`;
                  let imagestring = `<img src="${linkrootpath}" title="${title}" />`;
                  return imagestring;
                  }
                  else {
                    return match;
                  }
                }
              );

              //Fixup images in HTML style imates to absolute path
              fixcontent = fixcontent.replace(/ src\=["'](.*?)["']/g, 
                (match, path) => {
                  let linkrootpath=my_dir_path.slice();
                  let relpath = path;
                  if (relpath.startsWith('../')) {

                    while (relpath.startsWith('../')) {
                      relpath = relpath.slice(3);
                      linkrootpath.pop();
                    }

                  linkrootpath = linkrootpath.join('/');
                  linkrootpath = `${linkrootpath}/${relpath}`;
                  let imagestring = ` src='${linkrootpath}'`;
                  return imagestring;
                  }
                  else {
                    return match;
                  }

                }
              );

              // Make the github heading anchor format change to docsify format
              fixcontent = fixcontent.replaceAll(/\s*{#([\w-]*)}/g, " :id=$1");

              // Fix up notes/tips with > **Note** syntax.
              fixcontent = fixcontent.replaceAll('> **Note** ','\n?> **Note:** ');
              fixcontent = fixcontent.replaceAll('> **Tip** ','\n?> **Tip:** ');
              fixcontent = fixcontent.replaceAll('> **Warning** ','\n!> **Warning:** ');
              fixcontent = fixcontent.replaceAll('> **Caution** ','\n!> **Warning:** ');

              // Fix up notes/tips with ::: syntax
              fixcontent = fixcontent.replaceAll(/\:{3}(\S+)$(.*?)\:{3}/gsm, 
                (match, type, note_text) => {
                  if (type.startsWith('note')) {
                    return `\n?> **Note:** ${note_text}`;
                  }
                  else if (type.startsWith('tip')) {
                    return `\n?> **Tip:** ${note_text}`;
                  }
                  else if (type.startsWith('warning')) {
                    return `\n!> **Warning:** ${note_text}`;
                  }
                return match;
                }
              );

              return fixcontent;
            }

            //Return the original if there is no other fixes happening.
            return content
          });


          hook.doneEach(function() {
              // Invoked each time after the data is fully loaded, no arguments,


          });



        }
      ],

    }
  </script>
  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
  
  <!-- Namespaces: https://evilmartians.com/chronicles/easy-multi-language-multi-version-documentation-with-docsify-git-and-github-actions  -->
  <script src="https://unpkg.com/docsify-namespaced"></script>
  
  <!-- full text search: very cool but does not work on our size of database - though it might with some hints -->
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  

</body>
</html>
