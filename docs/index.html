<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
</head>
<body>
  <nav></nav>
  <div id="app">Waiting to load ...</div>
  <script>
    window.$docsify = {
      name: 'Test User Guide',
      repo: '',
      loadSidebar: "SUMMARY.md",
      loadNavbar: true,
      /* basePath: '/qgc-user-guide/',*/
      /* relativePath: true, */
      subMaxLevel: 3,
      search: "auto",
	  
      alias: {
	   //"/en/(.*)": "/qgc-user-guide/en/$1",
	    //"/en/(.*)": "https://raw.githubusercontent.com/hamishwillee/qgroundcontrol/master/docs/qgc-user-guide/en/$1",
       // "/zh/(.*)": "https://raw.githubusercontent.com/hamishwillee/qgroundcontrol/master/docs/qgc-user-guide/zh/$1",
       // "/ko/(.*)": "https://raw.githubusercontent.com/hamishwillee/qgroundcontrol/master/docs/qgc-user-guide/ko/$1",
      },
	  
      plugins: [
        function(hook) {
		  let current_path_page = location.href.split('/#/')?.[1]; //The string for translation - e.n
		  let current_path_page_array = current_path_page?.split('/');
		  let current_pagename=`${current_path_page_array.pop()}.md`;
		  let current_path = `/${current_path_page_array.join("/")}`;
		  let current_path_back_one = `/${current_path_page_array.slice(0,-1).join("/")}`;
		  let current_path_back_two = `/${current_path_page_array.slice(0,-2).join("/")}`;
		  //let path_back_two = current_path_page_array.pop()//.join('/');
		  let translation = current_path_page_array[0]; //The string for translation - e.g.:en
		  
          let footer = [
            '<hr/>',
            '<footer>',
            '<span><a href="Z">?</a> &copy;?.</span>',
			'<span>X',
			translation,
			'pagename:',
			current_pagename,
			'PATHNAME:',
            current_path,
			'PATHBACK1:',
            current_path_back_one,
			'PATHBACK2:',
            current_path_back_two,
			'Z</span>',
            '<span>Proudly published with <a href="X" target="_blank">docsify</a>.</span>',
            '</footer>'
          ].join('');
		
		
          //Fixup images. There's bug that means it can't find them in the tree, but we can get them from github.
          hook.beforeEach(function(content) {
		    let fixcontent=content;
		    //Fix links to point to static assets on github.
            //fixcontent = fixcontent.replace(/..\/..\/assets/g, "https://raw.githubusercontent.com/hamishwillee/qgroundcontrol/master/docs/qgc-user-guide/assets");
			//This works because all relative links in lib are relative and so going back one level takes you to base. So I'm just replacing a the base
			// A more corect fix would get the url of page then pop it back by one, then append the extra bits.
			//fixcontent = content.replace(/\!\[(.*?)\]\((..\/..\/assets.*?)\)/g, '<img src="$2" alt="$1" title="$1" />');
			
			//fixcontent = content.replace(/\!\[(.*?)\]\((.*?)\)/g, '<img src="$2" title="$1" />'); // make all image links into to base
			fixcontent = content.replace(/\!\[(.*?)\]\((.*?assets\/)(.*?)\)/g, '<img src="/assets/$3" title="$1" />'); // force assets to root
            fixcontent = fixcontent.replace(/\]\(..\//g, `](${ current_path_back_one }/`);
			fixcontent = fixcontent.replace(/\]\(..\/..\//g, `](${ current_path_back_two }/`);
            return fixcontent
          });
		  
          hook.afterEach(function(html) {
            return html + footer;
          });
		  
        }
      ],


	  /*
      markdown: {
      // https://marked.js.org/#/USING_PRO.md#renderer
        renderer: {
          image: function(href, title) {
              return `<img src="https://raw.githubusercontent.com/hamishwillee/qgroundcontrol/master/docs/qgc-user-guide/x/x/${href}" data-origin="${href}" alt="${title}">`
          }
        }
      },
	  */
	  
  
    }
  </script>
  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/sidebar.min.css" />
</body>
</html>
